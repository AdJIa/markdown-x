# 提案 (Proposal)

## 元信息
- **功能名称**: 全局搜索功能
- **提案时间**: 2026-01-31 06:35
- **提案人**: OpenSpec Agent
- **状态**: ✅ 已通过
- **基于探索报告**: [.openspec/explore/20260131-search-feature-report.md](../explore/20260131-search-feature-report.md)

---

## 1. 执行摘要

### 1.1 一句话描述
为 Markdown-X 添加全局搜索功能，让用户可以跨所有 Markdown 文件快速搜索内容。

### 1.2 价值主张
**解决用户痛点**: 文档多了找不到内容 → **提升工作效率 5-10 倍**

---

## 2. 背景 (基于探索报告)

### 2.1 问题陈述
当前用户管理多个 Markdown 站点时，无法跨文件搜索内容，需要逐个打开文件查看，效率极低。

### 2.2 目标用户
技术文档写作者、知识库管理者、笔记重度用户

### 2.3 约束条件
- 性能要求: 1000 文件搜索 < 2 秒
- 时间限制: 1 周内完成
- 单人开发

---

## 3. 提案内容 (WHAT)

### 3.1 功能概述
实现一个全局搜索面板，支持：
1. 快捷键触发搜索 (Cmd/Ctrl + Shift + F)
2. 实时搜索结果显示
3. 点击结果跳转到对应文件位置
4. 搜索历史记录

### 3.2 功能清单
- [x] **搜索面板 UI**: 弹窗式搜索界面，含搜索框和结果列表
- [x] **搜索服务**: 主进程遍历文件、读取内容、匹配关键词
- [x] **结果展示**: 文件名、匹配行预览、高亮匹配内容
- [x] **快速跳转**: 点击结果直接打开文件并跳转到对应位置
- [x] **快捷键**: Cmd/Ctrl + Shift + F 打开搜索面板
- [x] **历史记录**: 保存最近 10 条搜索记录

### 3.3 用户价值
- **秒级定位**: 输入关键词，立即找到相关文件
- **上下文预览**: 看到匹配内容所在的行，快速判断
- **一键跳转**: 直接打开文件，无需手动导航

### 3.4 边界范围
#### In Scope (包含)
- 基于文本内容的全文搜索
- 实时搜索 (非预建索引)
- 单关键词搜索
- 搜索结果预览

#### Out of Scope (不包含)
- 正则表达式
- 模糊搜索
- 预建索引
- 搜索结果导出

---

## 4. 成功指标

### 4.1 定量指标
| 指标 | 目标值 | 测量方式 |
|------|--------|----------|
| 搜索响应时间 | < 2s (1000文件) | 手动测试 |
| 搜索准确率 | 100% (文本匹配) | 单元测试 |
| 代码覆盖率 | > 80% | jest --coverage |

### 4.2 定性指标
- [x] 用户可以秒级找到目标内容
- [x] 搜索结果准确无遗漏
- [x] 界面交互流畅自然

---

## 5. 风险评估

### 5.1 已知风险
| 风险 | 可能性 | 影响 | 缓解策略 |
|------|--------|------|----------|
| 大量文件搜索卡顿 | 中 | 高 | 限制并发、添加取消按钮 |
| 搜索结果过多 | 低 | 中 | 限制最大结果数 100 条 |
| 权限问题无法读取 | 低 | 中 | 错误处理，跳过无权限文件 |

### 5.2 未知风险
- 用户可能有超大文件 (>100MB)
- 网络驱动器文件搜索性能

---

## 6. 替代方案

### 6.1 方案对比
| 方案 | 优点 | 缺点 | 评估 |
|------|------|------|------|
| 实时遍历 (推荐) | 实现简单，无维护成本 | 大量文件性能一般 | ✅ 采用 |
| 预建索引 | 搜索极快 | 实现复杂，需要维护索引 | ❌ 延后 |
| 使用外部工具 | 零开发成本 | 依赖用户安装，体验差 | ❌ 放弃 |

### 6.2 推荐方案及理由
**推荐: 实时遍历搜索**
- 符合 MVP 原则，快速交付
- 满足当前用户规模需求
- 后续可平滑升级为预建索引

---

## 7. 时间/资源估算

### 7.1 粗略估算
- 开发时间: 4 天
- 测试时间: 1 天
- 文档时间: 0.5 天
- 缓冲: 0.5 天
- **总时间: 6 天**

### 7.2 所需资源
- 人员: 1 名前端开发
- 外部依赖: 无

---

## 8. 下一步

提案通过后，进入 **规格细化 (Spec)** 阶段。

运行: `./openspec-dev.sh spec search-feature`

---

## 审查清单

- [x] 基于探索报告
- [x] WHAT 清晰明确
- [x] 成功指标可衡量
- [x] 风险评估完整
- [x] 替代方案考虑
- [x] 可追溯性建立

---

**审查结论**: ✅ 通过，可以进入 SPEC 阶段
