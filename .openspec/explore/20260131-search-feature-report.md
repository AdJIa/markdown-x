# 探索报告 (Explore Report)

## 元信息
- **功能名称**: 全局搜索功能
- **探索时间**: 2026-01-31 06:30
- **探索者**: OpenSpec Agent
- **状态**: ✅ 已完成

---

## 1. WHY - 为什么要解决这个问题？

### 1.1 痛点描述
当前 Markdown-X 缺少全局搜索功能。当用户管理多个 Markdown 站点/文件夹时：
- 无法跨文件搜索内容
- 定位特定内容需要逐个文件打开查看
- 大量文件时效率极低

### 1.2 不解决会怎样？
- 用户体验差，难以管理大量文档
- 可能转向其他带搜索功能的编辑器
- 工作效率低下

### 1.3 解决了带来什么价值？
- 秒级定位任意文件中的内容
- 支持多站点统一管理
- 提升用户留存率

---

## 2. WHO - 为谁解决这个问题？

### 2.1 目标用户
- 技术文档写作者
- 知识库管理者
- 笔记重度用户

### 2.2 用户场景
**场景 1**: 用户有 50+ 篇技术文档，想找"Electron IPC"相关内容
**场景 2**: 用户想查看所有包含 TODO 标记的文件
**场景 3**: 用户需要查找某个 API 在所有文档中的引用

### 2.3 用户当前如何 workaround？
- 使用系统文件搜索 (如 grep/Spotlight)
- 记住文件位置
- 维护单独的索引文档

---

## 3. WHAT - 问题的边界在哪里？

### 3.1 问题范围 (In Scope)
- ✅ 基于文件内容的全文搜索
- ✅ 实时搜索结果展示
- ✅ 搜索结果预览和高亮
- ✅ 快捷键触发 (Cmd/Ctrl + Shift + F)
- ✅ 搜索历史记录

### 3.2 问题边界 (Out of Scope)
- ❌ 正则表达式搜索 (V2 考虑)
- ❌ 模糊搜索/语义搜索 (V2 考虑)
- ❌ 文件内容索引持久化 (V2 考虑)
- ❌ 搜索结果导出 (V2 考虑)

### 3.3 相关功能/模块
- 文件树组件 (FileTree)
- 编辑器组件 (Editor)
- 站点管理 (SiteManager)
- 文件系统监控 (chokidar)

---

## 4. CONTEXT - 上下文信息

### 4.1 相关系统/模块
```
┌─────────────────────────────────────────────────────────┐
│                      渲染进程                            │
│  ┌──────────────┐      ┌──────────────┐                │
│  │  SearchPanel │      │ FileTree     │                │
│  │  (UI 组件)    │      │ (现有)       │                │
│  └──────┬───────┘      └──────┬───────┘                │
│         │                     │                         │
│         └──────────┬──────────┘                         │
│                    │                                    │
│              App Context                                │
└────────────────────┬────────────────────────────────────┘
                     │ IPC
┌────────────────────┼────────────────────────────────────┐
│                    ▼           主进程                    │
│  ┌──────────────────────────────────────┐              │
│  │  Search Service                      │              │
│  │  - 遍历文件                          │              │
│  │  - 内容读取                          │              │
│  │  - 文本匹配                          │              │
│  └──────────────────────────────────────┘              │
│                    │                                    │
│         ┌──────────┴──────────┐                        │
│         ▼                     ▼                        │
│  File System            chokidar                       │
└─────────────────────────────────────────────────────────┘
```

### 4.2 依赖关系
| 依赖项 | 类型 | 说明 |
|--------|------|------|
| chokidar | 现有 | 文件系统监控 |
| electron-store | 现有 | 配置存储 |
| Node.js fs | 内置 | 文件读取 |

### 4.3 影响范围
- **新增**: SearchPanel 组件、Search Service
- **修改**: App.tsx (添加快捷键)、preload.ts (IPC 通道)
- **无影响**: Editor、Preview 组件

---

## 5. CONSTRAINTS - 约束条件

### 5.1 技术约束
- [x] 技术栈限制: Electron 30 + React 18 + TypeScript
- [x] 性能要求: 1000 个文件搜索 < 2 秒
- [x] 兼容性: 支持 Windows/macOS/Linux

### 5.2 业务约束
- [x] 时间限制: 1 周内完成
- [x] 资源限制: 单人开发
- [x] 优先级: P1 (高优先级)

### 5.3 其他约束
- [ ] 法律法规: 无
- [x] 安全合规: 不能搜索应用目录外的敏感路径

---

## 6. 探索发现

### 6.1 关键发现
1. 搜索应该支持多个站点的聚合搜索
2. 需要限制单次搜索的最大文件数 (避免内存问题)
3. 大文件 (>10MB) 应该跳过或只搜索部分内容
4. 二进制文件应该自动排除

### 6.2 开放问题
- 搜索时是否包含已删除但缓存的文件？
- 搜索结果如何排序 (文件名/修改时间/相关度)？

### 6.3 假设列表
- 用户搜索的关键字长度 >= 2
- 用户管理的文件总数 < 10000
- 单个文件大小 < 100MB

---

## 7. 初步建议

### 7.1 可能的解决方向
**方向 A**: 实时遍历搜索 (简单，但性能一般)
**方向 B**: 预建索引 (性能好，但实现复杂)
**方向 C**: 混合方案 (首次遍历，后续增量)

### 7.2 推荐方向及理由
**推荐: 方向 A (实时遍历搜索)**
- 理由 1: MVP 优先，快速交付
- 理由 2: 对于 <1000 文件场景性能足够
- 理由 3: 后续可升级为方向 C

### 7.3 风险评估
| 风险 | 可能性 | 影响 | 缓解措施 |
|------|--------|------|----------|
| 大量文件搜索卡顿 | 中 | 高 | 限制并发、添加取消按钮 |
| 搜索结果过多 | 低 | 中 | 限制最大结果数 |
| 权限问题无法读取文件 | 低 | 中 | 添加错误处理 |

---

## 8. 下一步

基于本探索报告，下一步应创建 **提案 (Proposal)**。

运行: `./openspec-dev.sh propose search-feature`

---

## 审查清单

- [x] WHY 清晰明确
- [x] WHO 定义清楚
- [x] WHAT 边界明确
- [x] CONTEXT 完整
- [x] CONSTRAINTS 已识别
- [x] 可追溯性建立
